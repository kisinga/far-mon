# Mosquitto MQTT Broker Configuration for Farm Stack
# 
# This configuration provides:
# - MQTT on port 1883 (plain text)
# - MQTT over WebSocket on port 9001 (for web clients)
# - Optional TLS on port 8883
# - Persistence for message retention
# - Logging configuration optimized for farm monitoring

# Basic Settings
pid_file /var/run/mosquitto.pid
persistence true
persistence_location /mosquitto/data/
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
connection_messages true
log_timestamp true

# Network Settings
bind_address 0.0.0.0

# Standard MQTT port
listener 1883
protocol mqtt

# WebSocket support for web-based clients (Node-RED dashboard, etc.)
listener 9001
protocol websockets

# Authentication (basic - enhance for production)
allow_anonymous true
# Uncomment and configure for authentication:
# password_file /mosquitto/config/passwd
# acl_file /mosquitto/config/acl

# Message Size Limits
message_size_limit 10485760    # 10MB max message size
max_inflight_messages 20
max_queued_messages 1000

# Connection Limits
max_connections 1000
max_keepalive 65535

# Persistence Settings
autosave_interval 1800         # Save DB every 30 minutes
autosave_on_changes false
persistent_client_expiration 2d

# Bridge Configuration (for external MQTT brokers if needed)
# connection bridge-01
# address external-broker.example.com:1883
# topic farm/# out 0
# topic external/# in 0

# TLS Configuration (uncomment and configure for encrypted connections)
# listener 8883
# protocol mqtt
# cafile /mosquitto/config/ca.crt
# certfile /mosquitto/config/server.crt
# keyfile /mosquitto/config/server.key
# tls_version tlsv1.2
# ciphers HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA

# Security Settings
# Disable $SYS tree for external access (comment out to enable)
# sys_interval 0

# WebSocket-specific settings
# websockets_log_level 255
# websockets_headers_size 1024
